---
title: 第8节：抽奖规则树模型结构设计
pay: https://t.zsxq.com/16IWY84jr
---

# 《大营销平台系统设计实现》 - 营销服务 第8节：抽奖规则树模型结构设计

作者：小傅哥
<br/>博客：[https://bugstack.cn](https://bugstack.cn)

>沉淀、分享、成长，让自己和他人都能有所收获！😄

- **本章难度**：★★★☆☆
- **本章重点**：针对抽奖中到抽奖后的规则衔接过滤的多样性，使用组合模式的规则树结构设计，根据配置自动完成流程调用。
- **课程视频**：[https://t.zsxq.com/16ICK8eeS](https://t.zsxq.com/16ICK8eeS)

**版权说明**：©本项目与星球签约合作，受[《中华人民共和国著作权法实施条例》](http://www.gov.cn/zhengce/2020-12/26/content_5573623.htm) 版权法保护，禁止任何理由和任何方式公开(public)源码、资料、视频等内容到Github、Gitee等，违反可追究进一步的法律行动。

## 一、本章诉求

本章节需要引入新的设计模式结构，解决先阶段中抽奖策略规则的中、后两部分执行问题。通过组合模式的规则引擎，让过滤节点可以满足一颗二叉树的结构，自由的组合和多分支链路的方式完成流程的处理。

## 二、流程设计

这里有一个矛盾点需要解决。对于抽奖策略的前置规则过滤是顺序一条链的，有一个成功就可以返回。比如；黑名单抽奖、权重人群抽奖、默认抽奖，总之它只能有一种情况，所以这样的流程是适合责任链的。

<div align="center">
    <img src="https://bugstack.cn/images/article/project/big-market/big-market-10-01.png" width="650px">
</div>

那么对于抽奖中到抽奖后的规则，它是一个非多分支情况的规则过滤。单独的责任链是不能满足的，如果是拆分开抽奖中规则和抽奖后规则分阶段处理，中间单独写逻辑处理库存操作。那么是可以实现的。但这样的方式始终不够优雅，配置化的内容较低，后续的规则开发仍需要在代码上改造。所以这里小傅哥会带着大家实现一版组合模式的决策树模型设计。

<div align="center">
    <img src="https://bugstack.cn/images/article/project/big-market/big-market-10-02.png" width="650px">
</div>

注意：设计模式是思想，就和学武术练太极一样，理论和实践是两回事。招式要随着场景因地制宜的变化，而不是生搬硬套一些设计模式的案例学习。